package main

import (
	standardLog "log"
	"time"

	"github.com/arman1371/vulnerability-scanner-api/handlers"
	"github.com/arman1371/vulnerability-scanner-api/log"
	"github.com/arman1371/vulnerability-scanner-api/trivyhelper"
	ginzap "github.com/gin-contrib/zap"
	"github.com/gin-gonic/gin"
)

func main() {
	if err := log.InitLogger(); err != nil {
		standardLog.Fatalf("Error in initializing logger. %v\n", err)
	}

	if err := trivyhelper.InitTrivyHelper(); err != nil {
		log.FatalF("Error in initializing the trivy helper. %v", err)
	}

	router := gin.New()
	router.Use(ginzap.Ginzap(log.Logger.Desugar(), time.RFC3339, true), ginzap.RecoveryWithZap(log.Logger.Desugar(), true))

	router.POST("scan", handlers.Scan)

	_ = router.Run(":8081")
}
